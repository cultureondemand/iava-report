var half_perc;var pie;var scolor='';var width=310,height=396,radius=(Math.min(width,height)-110)/2;var arc=d3.svg.arc().outerRadius(radius-12).innerRadius(12);var outerArc=d3.svg.arc().innerRadius(radius*0.75).outerRadius(radius*0.75);var labelArc=d3.svg.arc().outerRadius(radius+20).innerRadius(radius-5);var legendRectSize=(radius*0.07);var legendSpacing=radius*0.08;var div=d3.select("body").append("div").attr("class","toolTip");var legendRectSize=(radius*0.07);var legendSpacing=radius*0.11;function drawPieChart(dataset){var name="svg"+this.iii;var width=310,height=396,radius=(Math.min(width,height)-110)/2;var donutchart=d3.select("#"+name).append("g")
donutchart.append("g").attr("class","slices");donutchart.append("g").attr("class","legend");donutchart.append("g").attr("class","labelName");donutchart.append("g").attr("class","labelValue");donutchart.append("g").attr("class","lines");pie=d3.layout.pie().sort(null).value(function(d){return d.b;});var arc=d3.svg.arc().outerRadius(radius-12).innerRadius(12);var outerArc=d3.svg.arc().innerRadius(radius*0.75).outerRadius(radius*0.75);var labelArc=d3.svg.arc().outerRadius(radius+20).innerRadius(radius-5);var outerArc=d3.svg.arc().innerRadius(radius*0.75).outerRadius(radius*0.75);var legendRectSize=(radius*0.07);var legendSpacing=radius*0.11;donutchart.attr("transform","translate("+width/2+","+height/3.45+")");var color=d3.scale.ordinal().range(["#dcf428","#9aada6","#c2cec9","#efefef","#888888","#333333","#294636","#3a634d","#000000","#e2d497","#417a4f","#cddeb7","#78933f","#284635"]);var slice=donutchart.select(".slices").selectAll("path.slice").data(pie(dataset),function(d){return d.data.a});slice.enter().insert("path").style("fill",function(d,i){return(color(d.data.a));}).attr("class","slice")
scolor++;slice.transition().duration(1000).attrTween("d",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){return arc(interpolate(t));};})
slice.on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.data.a)+"<h4>"+(d.data.b)+"%</h4>");});slice.on("mouseout",function(d){div.style("display","none");});slice.exit().remove();var text=donutchart.select(".labelName").selectAll("text").data(pie(dataset),function(d){return d.data.b+"% "+d.data.a})
text.enter().append("text").attr("text-anchor","middle").text(function(d){return(d.data.a);}).append("text").attr("text-anchorB","middle").text(function(d){return(d.data.b+"%");});function midAngle(d){return d.startAngle+(d.endAngle-d.startAngle)/2;}text.transition().duration(1000).attrTween("transform",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);var pos=labelArc.centroid(d2);return"translate("+pos+")";};}).styleTween("text-anchor",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);return radius*(midAngle(d2)<Math.PI?1:-1);var namename=(d.data.b+"%"+d.data.a);};}).text(function(d){if(d.data.b<2){return'';}if(d.data.b<5){return(d.data.b+"%");}return(d.data.a);}).styleTween("text-anchorB",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);return arc.centroid(d2);var namename=(d.data.b+"%"+d.data.a);};}).text(function(d){if(d.data.b<2){return'';}if(d.data.b<5){return'';}return(d.data.a);});text.exit().remove();var polyline=donutchart.select(".lines").selectAll("polyline").data(pie(dataset),function(d){return d.data.a});polyline.enter().append("polyline");polyline.transition().duration(1000).attrTween("points",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);var pos=arc.centroid(d2);pos[0]=radius/0.95*(midAngle(d2)<Math.PI?1:-1);if(d.data.b<2){return'';}if(d.data.b<5){return'';}return[arc.centroid(d2),labelArc.centroid(d2)];};});polyline.exit().remove();iii++;};function changePieChart(dataset,name){var donutchart=d3.select("#"+name);donutchart.selectAll("text").remove();var color=d3.scale.ordinal().range(["#dcf428","#9aada6","#c2cec9","#efefef","#888888","#333333","#294636","#3a634d","#000000","#e2d497","#417a4f","#cddeb7","#78933f","#284635"]);var slice=donutchart.select(".slices").selectAll("path.slice").data(pie(dataset),function(d){return d.data.a});slice.enter().insert("path").style("fill",function(d){return color(d.data.a);}).attr("class","slice")
scolor++;slice.transition().duration(1000).attrTween("d",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){return arc(interpolate(t));};})
slice.on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.data.a)+"<h4>"+(d.data.b)+"%</h4>");});slice.on("mouseout",function(d){div.style("display","none");});slice.exit().remove();var text=donutchart.select(".labelName").selectAll("text").data(pie(dataset),function(d){return d.data.b+"% "+d.data.a})
text.enter().append("text").attr("text-anchor","middle").text(function(d){return(d.data.a);}).append("text").attr("text-anchorB","middle").text(function(d){return(d.data.b+"%");});function midAngle(d){return d.startAngle+(d.endAngle-d.startAngle)/2;}text.transition().duration(1000).attrTween("transform",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);var pos=labelArc.centroid(d2);return"translate("+pos+")";};}).styleTween("text-anchor",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);return radius*(midAngle(d2)<Math.PI?1:-1);var namename=(d.data.b+"%"+d.data.a);};}).text(function(d){if(d.data.b<2){return'';}if(d.data.b<5){return(d.data.b+"%");}return(d.data.a);}).styleTween("text-anchorB",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);return arc.centroid(d2);var namename=(d.data.b+"%"+d.data.a);};}).text(function(d){if(d.data.b<2){return'';}if(d.data.b<5){return'';}return(d.data.a);});text.exit().remove();var polyline=donutchart.select(".lines").selectAll("polyline").data(pie(dataset),function(d){return d.data.a});polyline.enter().append("polyline");polyline.transition().duration(1000).attrTween("points",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);var pos=arc.centroid(d2);pos[0]=radius/0.95*(midAngle(d2)<Math.PI?1:-1);if(d.data.b<2){return'';}if(d.data.b<5){return'';}return[arc.centroid(d2),labelArc.centroid(d2)];};});polyline.exit().remove();var legend=donutchart.select(".legend").selectAll("g").data(pie(dataset),function(d){return d.data.a});legend.enter().append("g").attr('transform',function(d,i){var height=legendRectSize+legendSpacing;var offset=height*i;var horz=legendRectSize-46;var vert=(height+offset)+92;return'translate('+(horz)+','+(vert)+')';}).append('circle').attr('r','8').attr('cx',legendRectSize).attr('cy',legendSpacing).on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.data.a)+"<h4>"+(d.data.b)+"%</h4>");}).on("mouseout",function(d){div.style("display","none");}).style("fill",function(d,i){return("url(#"+name+"_patternbar"+i+")"+color(d.data.a));}).style('stroke','none');legend.append('text').attr('class','legendtextp').attr('x',legendRectSize+legendSpacing).attr('y',(legendRectSize+legendSpacing)-2+"px").text(function(d){return d.data.a+": "+d.data.b+"%";}).on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.data.a)+"<h4>"+(d.data.b)+"%</h4>");}).on("mouseout",function(d){div.style("display","none");});legend.exit().remove();iii++;};function angle(d){var a=(d.startAngle+d.endAngle)*45/Math.PI-45;return a>45?a-90:a;}function type(d){d.b=+d.b;d.a=+d.a;return d;}d3.select(window).on('resize',resize);function resize(){var width=parseInt(d3.select("body").selectAll("svg").style("width"));}