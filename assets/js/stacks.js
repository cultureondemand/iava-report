var half_perc;var div=d3.select("body").append("div").attr("class","toolTip");function drawStackChart(data){var x=d3.scale.ordinal().rangeRoundBands([0,width],.1);var y=d3.scale.linear().rangeRound([height,0]);var name="svg"+this.iii;var legendname="barlegend"+this.iii;var width="100%",height=75,goal=100,perc_so_far=0;var color_range=d3.scale.ordinal().range(["#dcf428","#9aada6","#c2cec9","#efefef","#888888","#333333","#294636","#3a634d","#000000","#e2d497","#417a4f","#cddeb7","#78933f","#284635"]);var barlegend=d3.select("#legendrow"+iii)
var keyitem=barlegend.selectAll('div').data(data).enter().append("div").attr("class","legendblock").on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.a)+"<h4>"+(d.b)+"%</h4>");}).on("mouseout",function(d){div.style("display","none");});keyitem.append("div").attr("class","legendbox").style("background-color",function(d,i){return(color_range(i))})
keyitem.append('div').attr("class","legendtext").html(function(d,i){return(d.a+": <strong>"+d.b+"%</strong>")});var total_time=d3.sum(data);var bar_x=0;var chart=d3.select("#"+name).attr("width","100%").attr("height",height);bar_x=0;var chart_width=parseInt(d3.select("#"+name).style("width"));var bar=chart.selectAll("g").data(data).enter().append("g");bar.append("rect").attr("opacity","1").on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.a)+"<h4>"+(d.b)+"%</h4>");}).on("mouseout",function(d){div.style("display","none");}).attr("width",function(d){return(d.b)+"%";}).attr("x",function(d){var prev_perc=perc_so_far;var this_perc=(d.b);perc_so_far=perc_so_far+this_perc;return prev_perc+"%";}).attr("height",height).attr("fill",function(d,i){return(color_range(i))})
perc_so_far=0;bar.append("text").attr("class","bartext").attr("x",function(d){var prev_perc=perc_so_far;var this_perc=(d.b);var this_cohort=(d.a);var half_perc=((d.b)/2);perc_so_far=perc_so_far+this_perc;return prev_perc+"%";}).attr("dy","1.6em").attr("dx",".3em").text(function(d){if(d.b<10){return'';}return d.a+": "+d.b+"%";});iii++;};function changeStackChart(data,name){var x=d3.scale.ordinal().rangeRoundBands([0,width],.1);var y=d3.scale.linear().rangeRound([height,0]);var legendname="barlegend"+this.iii;var width="100%",height=75,goal=100,perc_so_far=0;var color_range=d3.scale.ordinal().range(["#dcf428","#9aada6","#c2cec9","#efefef","#888888","#333333","#294636","#3a634d","#000000","#e2d497","#417a4f","#cddeb7","#78933f","#284635"]);var barlegend=d3.select("#legendrow"+iii)
var keyitem=barlegend.selectAll('div').data(data).enter().append("div").attr("class","legendblock").on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.a)+"<h4>"+(d.b)+"%</h4>");}).on("mouseout",function(d){div.style("display","none");});keyitem.append("div").attr("class","legendbox").style("background-color",function(d,i){return(color_range(i))})
keyitem.append('div').attr("class","legendtext").html(function(d,i){return(d.a+": <strong>"+d.b+"%</strong>")});var total_time=d3.sum(data);var bar_x=0;var chart=d3.select("#"+name).attr("width","100%").attr("height",height);bar_x=0;var chart_width=parseInt(d3.select("#"+name).style("width"));var bar=chart.selectAll("g").data(data,function(d){return d.b;}).enter().append("g");bar.append("rect").attr("opacity","1").on("mousemove",function(d){div.style("left",d3.event.pageX+10+"px");div.style("top",(d3.event.pageY)-25+"px");div.style("display","inline-block");div.style("position","absolute");div.html((d.a)+"<h4>"+(d.b)+"%</h4>");}).on("mouseout",function(d){div.style("display","none");}).attr("width",0).attr("x",function(d){var prev_perc=perc_so_far;var this_perc=(d.b);perc_so_far=perc_so_far+this_perc;return prev_perc+"%";}).attr("height",height).attr("fill",function(d,i){return(color_range(i))});bar.attr("x",function(d){var prev_perc=perc_so_far;var this_perc=(d.b);perc_so_far=perc_so_far+this_perc;return prev_perc+"%";})
bar.append("text").attr("class","bartext").attr("x",function(d){var prev_perc=perc_so_far;var this_perc=(d.b);var this_cohort=(d.a);var half_perc=((d.b)/2);perc_so_far=perc_so_far+this_perc;return prev_perc+"%";}).attr("dy","1.6em").attr("dx",".3em");bar.html(function(d){if(d.b<20){return'<span style=font-size:50%;>'+d.b+'%</span>';}return d.a+": "+d.b+"%";});perc_so_far=0;iii++;};d3.select(window).on('resize',resize);function resize(){var width=parseInt(d3.select("body").selectAll("svg").style("width"));}